<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S·∫£n ph·∫©m - Ergoffice</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <div th:replace="~{fragments/navigation :: user-menu-styles}"></div>
    <style>
        .wishlist-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
            background: white;
            border-radius: 50%;
            padding: 6px 8px;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        }
        .wishlist-btn:hover {
            transform: scale(1.1);
        }
        .product-card {
            position: relative;
        }
    </style>
</head>
<body>

<div th:replace="~{fragments/navigation :: navigation}"></div>

<div class="container">
    <h2>Danh s√°ch s·∫£n ph·∫©m</h2>
    
    <div class="filters">
        <form th:action="@{/products}" method="get">
            <input type="text" name="keyword" th:value="${keyword}" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m...">
            <button type="submit">T√¨m ki·∫øm</button>
        </form>
        
        <div class="category-filter">
            <a th:href="@{/products}">T·∫•t c·∫£</a>
            <a th:each="category : ${categories}" 
               th:href="@{/products(categoryId=${category.categoryId})}"
               th:classappend="${selectedCategory == category.categoryId} ? 'active' : ''"
               th:text="${category.categoryName}">Category</a>
        </div>
    </div>

    <div class="product-grid">
        <div th:each="product : ${products}" class="product-card">
            <a sec:authorize="isAnonymous()"
               th:href="@{/login}"
               class="wishlist-btn">
                ü§ç
            </a>

            <!-- ‚ù§Ô∏è / ü§ç WISHLIST -->
            <div sec:authorize="isAuthenticated()">
                <!-- ƒê√É Y√äU TH√çCH -->
                <form th:if="${wishlistProductIds != null
                      and wishlistProductIds.contains(product.productId)}"
                      th:action="@{/wishlist/remove}" method="post">
                    <input type="hidden" name="productId" th:value="${product.productId}">
                    <button type="submit" class="wishlist-btn" title="B·ªè y√™u th√≠ch">‚ù§Ô∏è</button>
                </form>

                <!-- CH∆ØA Y√äU TH√çCH -->
                <form th:unless="${wishlistProductIds != null
                          and wishlistProductIds.contains(product.productId)}"
                      th:action="@{/wishlist/add}" method="post">
                    <input type="hidden" name="productId" th:value="${product.productId}">
                    <button type="submit" class="wishlist-btn" title="Th√™m y√™u th√≠ch">ü§ç</button>
                </form>
            </div>

            <a th:href="@{/product/{id}(id=${product.productId})}">
                
                <div class="product-image">
                    <img th:if="${!#lists.isEmpty(product.productImages)}" 
                         th:src="${#strings.startsWith(product.productImages[0].productImage, 'http') ? product.productImages[0].productImage : '/' + product.productImages[0].productImage}" 
                         th:alt="${product.name}"
                         style="width: 100%; height: 200px; object-fit: cover; border-radius: 10px 10px 0 0;">
                    <div th:if="${#lists.isEmpty(product.productImages)}" 
                         style="width: 100%; height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; border-radius: 10px 10px 0 0; color: white; font-size: 3rem;">
                        ü™ë
                    </div>
                </div>
                
                <div style="padding: 1rem;">
                    <h3 th:text="${product.name}">Product Name</h3>
                    <p th:text="${product.descript}">Description</p>
                    <div class="product-types">
                        <span th:each="type : ${product.productTypes}" 
                              th:text="${#numbers.formatDecimal(type.price, 0, 'COMMA', 0, 'POINT')} + ' VND'">Price</span>
                    </div>
                </div>
            </a>
        </div>
    </div>

    <div th:if="${#lists.isEmpty(products)}" class="no-results">
        <p>Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o.</p>
    </div>

    
    <div class="pagination-container" th:if="${totalPages > 1}" style="display: flex; justify-content: center; gap: 5px; margin-top: 2rem; flex-wrap: wrap;">
        
        <a th:if="${currentPage > 0}" 
           th:href="@{/products(page=${currentPage - 1}, keyword=${keyword}, categoryId=${selectedCategory})}"
           class="btn btn-outline-primary">&laquo;</a>

        
        <a th:if="${currentPage > 2}"
           th:href="@{/products(page=0, keyword=${keyword}, categoryId=${selectedCategory})}"
           class="btn btn-outline-primary">1</a>
           
        <span th:if="${currentPage > 3}" class="btn disabled">...</span>

        
        <th:block th:each="i : ${#numbers.sequence(currentPage > 2 ? currentPage - 2 : 0, currentPage + 2 < totalPages - 1 ? currentPage + 2 : totalPages - 1)}">
            <a th:href="@{/products(page=${i}, keyword=${keyword}, categoryId=${selectedCategory})}"
               th:text="${i + 1}"
               class="btn"
               th:classappend="${currentPage == i} ? 'btn-primary' : 'btn-outline-primary'"
               style="min-width: 40px;">1</a>
        </th:block>

        <span th:if="${currentPage < totalPages - 4}" class="btn disabled">...</span>

        
        <a th:if="${currentPage < totalPages - 3}"
           th:href="@{/products(page=${totalPages - 1}, keyword=${keyword}, categoryId=${selectedCategory})}"
           th:text="${totalPages}"
           class="btn btn-outline-primary">Last</a>

        
        <a th:if="${currentPage < totalPages - 1}"
           th:href="@{/products(page=${currentPage + 1}, keyword=${keyword}, categoryId=${selectedCategory})}"
           class="btn btn-outline-primary">&raquo;</a>
    </div>
</div>

<footer>
    <div class="container">
        <p>&copy; 2026 Ergoffice. All rights reserved.</p>
    </div>
</footer>

<div th:replace="~{fragments/navigation :: user-menu-scripts}"></div>
</body>
</html>

