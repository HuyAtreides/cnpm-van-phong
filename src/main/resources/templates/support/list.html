<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hỗ Trợ Khách Hàng | Ergoffice</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <div th:replace="~{fragments/navigation :: user-menu-styles}"></div>
    <style>
        .ticket-list { background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    </style>
</head>
<body>

<div th:replace="~{fragments/navigation :: navigation}"></div>

<div class="container py-5">
    
    <div th:if="${message}" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle me-2"></i> <span th:text="${message}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-circle me-2"></i> <span th:text="${error}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Yêu Cầu Hỗ Trợ</h2>
        <a href="/support/new" class="btn btn-primary"><i class="fas fa-plus me-2"></i>Tạo Yêu Cầu Mới</a>
    </div>

    <div th:if="${#lists.isEmpty(conversations)}" class="text-center py-5 bg-light rounded">
        <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
        <p class="text-muted">Bạn chưa có yêu cầu hỗ trợ nào.</p>
    </div>

    <div th:unless="${#lists.isEmpty(conversations)}" class="ticket-list p-3">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Tiêu Đề</th>
                    <th>Ngày Tạo</th>
                    <th>Trạng Thái</th>
                    <th>Hành Động</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="ticket : ${conversations}">
                    <td th:text="${ticket.title}" class="fw-bold">Tiêu đề lỗi</td>
                    <td th:text="${#dates.format(ticket.createdDate, 'dd/MM/yyyy HH:mm')}">01/01/2026</td>
                    <td>
                        <span th:if="${ticket.status == 'Open'}" class="badge bg-success">Đang mở</span>
                        <span th:if="${ticket.status == 'Closed'}" class="badge bg-secondary">Đã đóng</span>
                    </td>
                    <td>
                        <a th:href="@{/support/view(id=${ticket.conversationId})}" class="btn btn-sm btn-outline-primary">Xem chi tiết</a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<div th:replace="~{fragments/navigation :: user-menu-scripts}"></div>
</body>
</html>

